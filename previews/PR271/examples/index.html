<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · DiffEqBayes.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/DiffEqBayes/stable/examples/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="DiffEqBayes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">DiffEqBayes.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">DiffEqBayes.jl: Bayesian Parameter Estimation for Differential Equations</a></li><li><a class="tocitem" href="../methods/">Methods</a></li><li class="is-active"><a class="tocitem" href>Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqBayes.jl/blob/master/docs/src/examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Bayesian-Inference-Examples"><a class="docs-heading-anchor" href="#Bayesian-Inference-Examples">Bayesian Inference Examples</a><a id="Bayesian-Inference-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Bayesian-Inference-Examples" title="Permalink"></a></h1><h3 id="Stan"><a class="docs-heading-anchor" href="#Stan">Stan</a><a id="Stan-1"></a><a class="docs-heading-anchor-permalink" href="#Stan" title="Permalink"></a></h3><p>Like in the previous examples, we set up the Lotka-Volterra system and generate data.</p><pre><code class="language-julia hljs">f1 = @ode_def begin
  dx = a*x - b*x*y
  dy = -c*y + d*x*y
end a b c d
p = [1.5,1.0,3.0,1.0]
u0 = [1.0,1.0]
tspan = (0.0,10.0)
prob1 = ODEProblem(f1,u0,tspan,p)
sol = solve(prob1,Tsit5())
t = collect(range(1,stop=10,length=10))
randomized = VectorOfArray([(sol(t[i]) + .01randn(2)) for i in 1:length(t)])
data = convert(Array,randomized)</code></pre><p>Here we now give Stan an array of prior distributions for our parameters. Since the parameters of our differential equation must be positive, we utilize truncated Normal distributions to make sure that is satisfied in the result:</p><pre><code class="language-julia hljs">priors = [truncated(Normal(1.5,0.1),0,2),truncated(Normal(1.0,0.1),0,1.5),
          truncated(Normal(3.0,0.1),0,4),truncated(Normal(1.0,0.1),0,2)]</code></pre><p>We then give these to the inference function.</p><pre><code class="language-julia hljs">bayesian_result = stan_inference(prob1,t,data,priors;
                                 num_samples=100,num_warmup=500,
                                 vars = (StanODEData(),InverseGamma(4,1)))</code></pre><p><code>InverseGamma(4,1)</code> is our starting estimation for the variance hyperparameter of the default <code>Normal</code> distribution. The result is a <a href="http://mambajl.readthedocs.io/en/dev/intro.html">Mamba.jl</a> chain object. We can pull out the parameter values via:</p><pre><code class="language-julia hljs">theta1 = bayesian_result.chain_results[:,[&quot;theta.1&quot;],:]
theta2 = bayesian_result.chain_results[:,[&quot;theta.2&quot;],:]
theta3 = bayesian_result.chain_results[:,[&quot;theta.3&quot;],:]
theta4 = bayesian_result.chain_results[:,[&quot;theta.4&quot;],:]</code></pre><p>From these chains we can get our estimate for the parameters via:</p><pre><code class="language-julia hljs">mean(theta1.value[:,:,1])</code></pre><p>We can get more of a description via:</p><pre><code class="language-julia hljs">Mamba.describe(bayesian_result.chain_results)

# Result

Iterations = 1:100
Thinning interval = 1
Chains = 1,2,3,4
Samples per chain = 100

Empirical Posterior Estimates:
                  Mean         SD        Naive SE        MCSE         ESS
         lp__ -6.15472697 1.657551334 0.08287756670 0.18425029767  80.9314979
accept_stat__  0.90165904 0.125913744 0.00629568721 0.02781181930  20.4968668
   stepsize__  0.68014975 0.112183047 0.00560915237 0.06468790087   3.0075188
  treedepth__  2.68750000 0.524911975 0.02624559875 0.10711170182  24.0159141
 n_leapfrog__  6.77000000 4.121841086 0.20609205428 0.18645821695 100.0000000
  divergent__  0.00000000 0.000000000 0.00000000000 0.00000000000         NaN
     energy__  9.12245750 2.518330231 0.12591651153 0.32894488320  58.6109941
     sigma1.1  0.57164997 0.128579363 0.00642896816 0.00444242658 100.0000000
     sigma1.2  0.58981422 0.131346442 0.00656732209 0.00397310122 100.0000000
       theta1  1.50237077 0.008234095 0.00041170473 0.00025803930 100.0000000
       theta2  0.99778276 0.009752574 0.00048762870 0.00009717115 100.0000000
       theta3  3.00087782 0.009619775 0.00048098873 0.00020301023 100.0000000
       theta4  0.99803569 0.008893244 0.00044466218 0.00040886528 100.0000000
      theta.1  1.50237077 0.008234095 0.00041170473 0.00025803930 100.0000000
      theta.2  0.99778276 0.009752574 0.00048762870 0.00009717115 100.0000000
      theta.3  3.00087782 0.009619775 0.00048098873 0.00020301023 100.0000000
      theta.4  0.99803569 0.008893244 0.00044466218 0.00040886528 100.0000000

Quantiles:
                  2.5%        25.0%      50.0%      75.0%       97.5%
         lp__ -10.11994750 -7.0569000 -5.8086150 -4.96936500 -3.81514375
accept_stat__   0.54808912  0.8624483  0.9472840  0.98695850  1.00000000
   stepsize__   0.57975100  0.5813920  0.6440120  0.74276975  0.85282400
  treedepth__   2.00000000  2.0000000  3.0000000  3.00000000  3.00000000
 n_leapfrog__   3.00000000  7.0000000  7.0000000  7.00000000 15.00000000
  divergent__   0.00000000  0.0000000  0.0000000  0.00000000  0.00000000
     energy__   5.54070300  7.2602200  8.7707000 10.74517500 14.91849500
     sigma1.1   0.38135240  0.4740865  0.5533195  0.64092575  0.89713635
     sigma1.2   0.39674703  0.4982615  0.5613655  0.66973025  0.88361407
       theta1   1.48728600  1.4967650  1.5022750  1.50805500  1.51931475
       theta2   0.97685115  0.9914630  0.9971435  1.00394250  1.01765575
       theta3   2.98354100  2.9937575  3.0001450  3.00819000  3.02065950
       theta4   0.97934128  0.9918495  0.9977415  1.00430750  1.01442975
      theta.1   1.48728600  1.4967650  1.5022750  1.50805500  1.51931475
      theta.2   0.97685115  0.9914630  0.9971435  1.00394250  1.01765575
      theta.3   2.98354100  2.9937575  3.0001450  3.00819000  3.02065950
      theta.4   0.97934128  0.9918495  0.9977415  1.00430750  1.01442975</code></pre><p>More extensive information about the distributions is given by the plots:</p><pre><code class="language-julia hljs">plot_chain(bayesian_result)</code></pre><h3 id="Turing"><a class="docs-heading-anchor" href="#Turing">Turing</a><a id="Turing-1"></a><a class="docs-heading-anchor-permalink" href="#Turing" title="Permalink"></a></h3><p>This case we will build off of the Stan example. Note that <code>turing_inference</code> does not require the use of the <code>@ode_def</code> macro like Stan does, but it will still work with macro-defined functions. Thus, using the same setup as before, we simply give the setup to:</p><pre><code class="language-julia hljs">bayesian_result = turing_inference(prob1,Tsit5(),t,data,priors;num_samples=500)</code></pre><p>The result is a <a href="https://github.com/TuringLang/MCMCChains.jl"><code>MCMCChains.jl</code></a> chains object. The chain for the first parameter is then given by:</p><pre><code class="language-julia hljs">bayesian_result[&quot;theta[1]&quot;]</code></pre><p>Summary statistics can be also be accessed:</p><pre><code class="language-julia hljs">using StatsBase
describe(bayesian_result)</code></pre><p>The chain can be analysed by the trace plots and other plots obtained by:</p><pre><code class="language-julia hljs">using StatsPlots
plot(bayesian_result)</code></pre><h3 id="DynamicHMC"><a class="docs-heading-anchor" href="#DynamicHMC">DynamicHMC</a><a id="DynamicHMC-1"></a><a class="docs-heading-anchor-permalink" href="#DynamicHMC" title="Permalink"></a></h3><p>We can use <a href="https://github.com/tpapp/DynamicHMC.jl">DynamicHMC.jl</a> as the backend for sampling with the <code>dynamic_inference</code> function. It supports any <code>DEProblem</code>, <code>priors</code> can be passed as an array of <a href="https://juliastats.github.io/Distributions.jl/dev/">Distributions.jl</a> distributions, passing <code>initial</code> values is optional and in case where the user has a firm understanding of the domain the parameter values will lie in, <code>transformations</code> can be used to pass an array of constraints for the parameters as an array of <a href="https://github.com/tpapp/ContinuousTransformations.jl">Transformations</a>.</p><pre><code class="language-julia hljs">bayesian_result_hmc = dynamichmc_inference(prob1, Tsit5(), t, data, [Normal(1.5, 1)], [bridge(ℝ, ℝ⁺, )])</code></pre><p>A tuple with summary statistics and the chain values is returned. The chain for the <code>i</code>th parameter is given by:</p><pre><code class="language-julia hljs">bayesian_result_hmc[1][i]</code></pre><p>For accessing the various summary statistics:</p><pre><code class="language-julia hljs">DynamicHMC.NUTS_statistics(bayesian_result_dynamic[2])</code></pre><p>Some details about the NUTS sampler can be obtained from:</p><pre><code class="language-julia hljs">bayesian_result_dynamic[3]</code></pre><p>In case of <code>dynamic_inference</code> the trace plots for the <code>i</code>th parameter can be obtained by:</p><pre><code class="language-julia hljs">plot(bayesian_result_hmc[1][i])</code></pre><p>For a better idea of the summary statistics and plotting you can take a look at the <a href="https://github.com/JuliaDiffEq/DiffEqBenchmarks.jl">benchmarks</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../methods/">« Methods</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 9 December 2022 00:25">Friday 9 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
